<!-- Monitoring.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мониторинг оценок</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        th {
            cursor: pointer;
            background-color: #f2f2f2;
        }
    </style>
    <script>
        function loadRatings() {
            const ratings = JSON.parse(localStorage.getItem('ratings')) || [];
            updateTable(ratings);
            updateCount(ratings);
        }
        
        function updateTable(ratings) {
            const tableBody = document.getElementById('ratingsTable');
            tableBody.innerHTML = '';
            ratings.forEach(({ rating, timestamp }) => {
                const row = `<tr><td>${rating}</td><td>${new Date(timestamp).toLocaleString()}</td></tr>`;
                tableBody.innerHTML += row;
            });
        }
        
        function filterRatings() {
            const filterDate = document.getElementById('filterDate').value;
            let ratings = JSON.parse(localStorage.getItem('ratings')) || [];
            if (filterDate) {
                ratings = ratings.filter(({ timestamp }) => timestamp.startsWith(filterDate));
            }
            updateTable(ratings);
            updateCount(ratings);
        }
        
        function updateCount(ratings) {
            const countExcellent = ratings.filter(r => r.rating === 'Отлично').length;
            const countGood = ratings.filter(r => r.rating === 'Хорошо').length;
            const countBad = ratings.filter(r => r.rating === 'Плохо').length;
            
            document.getElementById('countExcellent').textContent = countExcellent;
            document.getElementById('countGood').textContent = countGood;
            document.getElementById('countBad').textContent = countBad;
        }

        function resetFilter() {
            document.getElementById('filterDate').value = '';
            loadRatings();
        }

        function exportToCSV() {
            const ratings = JSON.parse(localStorage.getItem('ratings')) || [];
            let csvContent = "data:text/csv;charset=utf-8,Оценка,Дата и время\n";
            ratings.forEach(({ rating, timestamp }) => {
                csvContent += `${rating},${new Date(timestamp).toLocaleString()}\n`;
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "ratings.csv");
            document.body.appendChild(link);
            link.click();
        }
    </script>
</head>
<body onload="loadRatings()">
    <h1>Мониторинг оценок</h1>
    <label for="filterDate">Фильтр по дате:</label>
    <input type="date" id="filterDate" onchange="filterRatings()">
    <button onclick="resetFilter()">Сбросить</button>
    <button onclick="exportToCSV()">Экспорт в CSV</button>
    
    <h2>Статистика</h2>
    <p>Отлично: <span id="countExcellent">0</span></p>
    <p>Хорошо: <span id="countGood">0</span></p>
    <p>Плохо: <span id="countBad">0</span></p>
    
    <table>
        <thead>
            <tr>
                <th onclick="sortTable(0)">Оценка</th>
                <th onclick="sortTable(1)">Дата и время</th>
            </tr>
        </thead>
        <tbody id="ratingsTable"></tbody>
    </table>
    <a href="index.html">Назад</a>
</body>
</html>
